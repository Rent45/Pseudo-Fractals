<!DOCTYPE html>
<html>
<head>
  <link rel="shortcut icon" type="image/x-icon" href="BILKA.png">
  <title>PseudoFractals</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
    }

      main{
        position: relative;
        left: 150px;
      }
    #settings {
      padding: 33px;
      box-sizing: border-box;
      background-color: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-right: -133px;
    }

    label {
      cursor: pointer;
      display: block;
      margin-bottom: 5px;
      color: #333;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      margin-bottom: 10px;
    }

    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <div id="settings">
  <button onclick="randomise()">Randomise</button>
  <button onclick="visualise()">Visualise</button>
  <br>
  <select id="functionSelector">
    <option value="zSquared">z^2</option>
    <option value="sinZ">sin(z)</option>
    <option value="cosZ">cos(z)</option>
    <option value="zPowerZ">z^z</option>
  </select>

  <select id="signSelector">
    <option value="plus">+</option>
    <option value="minus">-</option>
    <option value="multiply">*</option>
    <option value="divide">/</option>
  </select>
  <br>
  <label onclick="randomWidth();" for="widthInput">Picture Width:</label>
  <input type="number" id="widthInput" value="750">

  <label onclick="randomHeight();" for="heightInput">Picture Height:</label>
  <input type="number" id="heightInput" value="500">
  <br>
  <label onclick="randomMaxV();" for="MaxVal">Max Absolute Value:</label>
  <input type="number" id="MaxVal" value="5">

  <label onclick="randomMaxI();" for="MaxIt">Max Iterations:</label>
  <input type="number" id="MaxIt" value="20">
  <br>
  <label onclick="randomZoom();" for="ZoomInput">Zoom:</label>
  <input type="number" id="ZoomInput" value="0.9">

  <label onclick="randomX();" for="XInput">X offset:</label>
  <input type="number" id="XInput" value="-0.5">

  <label onclick="randomY();" for="YInput">Y Offset:</label>
  <input type="number" id="YInput" value="0">
  <br>
  <label id="Red11" onclick="randomColor(1,1);" for="Red1">Far from set, red colour:</label>
  <input type="number" id="Red1" value="0">

  <label id="Green11" onclick="randomColor(2,1);" for="Green1">Far from set, green colour:</label>
  <input type="number" id="Green1" value="225">

  <label id="Blue11" onclick="randomColor(0,1);" for="Blue1">Far from set, blue colour:</label>
  <input type="number" id="Blue1" value="255">
  <br>
  <label id="Red22" onclick="randomColor(1,2);" for="Red2">Close to set red, colour:</label>
  <input type="number" id="Red2" value="255">

  <label id="Green22" onclick="randomColor(2,2);" for="Green2">Close to set, green colour:</label>
  <input type="number" id="Green2" value="225">

  <label id="Blue22" onclick="randomColor(0,2);" for="Blue2">Close to set, blue colour:</label>
  <input type="number" id="Blue2" value="0">
  <br>
  <label id="Red33" onclick="randomColor(1,3);" for="Red3">In set red, colour:</label>
  <input type="number" id="Red3" value="0">

  <label id="Green33" onclick="randomColor(2,3);" for="Green3">In set, green colour:</label>
  <input type="number" id="Green3" value="0">

  <label id="Blue33" onclick="randomColor(0,3);" for="Blue3">In set, blue colour:</label>
  <input type="number" id="Blue3" value="75">
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script>
    for (let i = 2; i >= 0; i--) {
  for (let j = 3; j >= 1; j--) {
    let colors = ["Blue", "Red", "Green"];
    let input = document.getElementById(colors[i] + j);
      let redVal = parseInt(document.getElementById('Red' + j).value);
      let greenVal = parseInt(document.getElementById('Green' + j).value);
      let blueVal = parseInt(document.getElementById('Blue' + j).value);

      for (let d = 0; d <= 2; d++) {
        let targetElem = document.getElementById(colors[d] + j + j);
        targetElem.style.color = `rgb(${redVal}, ${greenVal}, ${blueVal})`;
        // console.log(targetElem.style.color);
        // console.log(targetElem);
      };
    }
  }
    //selectedFunction = parseFloat(document.getElementById('functionSelector').value);
    let width = parseInt(document.getElementById('widthInput').value);
    let height = parseInt(document.getElementById('heightInput').value);
    let textValx = [];
    let textValy = [];
    let importantx = [];
    let importanty = [];
    let counter = 0;
    function setup() {
      let canvas = createCanvas(width, height);
      pixelDensity(1);
      textSize(15);
    };
    function randomColor(i, j) {
      let colors = ["Blue", "Red", "Green"];
      let input = document.getElementById(colors[i] + j);
      input.value = Math.round(10 * 255 * Math.random()) / 10;
      for (let d = 0; d <= 2; d++) {
        let redVal = parseInt(document.getElementById('Red' + j).value);
        let greenVal = parseInt(document.getElementById('Green' + j).value);
        let blueVal = parseInt(document.getElementById('Blue' + j).value);
        let targetElem = document.getElementById(colors[d] + j + j);
        targetElem.style.color = `rgb(${redVal}, ${greenVal}, ${blueVal})`;
      }
    }
    function randomWidth() {
      document.getElementById('widthInput').value = Math.floor(Math.random()*3000);
    };
    function randomHeight() {
      document.getElementById('heightInput').value = Math.floor(Math.random()*3000);
    };
    function randomMaxV() {
      document.getElementById('MaxVal').value = Math.round(10*Math.random()*30)/10;
    };
    function randomMaxI() {
      document.getElementById('MaxIt').value = Math.floor(Math.random()*60);
    };
    function randomZoom() {
      document.getElementById('ZoomInput').value = Math.round(100*(Math.random() * (25) - 5))/100;
    };
    function randomX() {
      document.getElementById('XInput').value = Math.round(100*(Math.random() * (4) - 2))/100;
    };
    function randomY() {
      document.getElementById('YInput').value = Math.round(100*(Math.random() * (4) - 2))/100;
    };
    function randomise() {
      let funcs = ["zSquared","zPowerZ","sinZ","cosZ"];
      document.getElementById('functionSelector').value = funcs[Math.floor(Math.random()*4)];
      let signs = ["plus","minus","multiply","divide"];
      document.getElementById('signSelector').value = signs[Math.floor(Math.random()*4)];
      randomWidth();
      randomHeight();
      randomMaxV();
      randomMaxI();
      randomZoom();
      randomX();
      randomY();
      for (var i = 0; i <= 2; i++) {
        for (var j = 1; j <= 3; j++) {
          randomColor(i,j)
        }
      }
    }
    function visualise() {
      counter++;
      clear();
      selectedFunction = document.getElementById('functionSelector').value;
      selectedSign = document.getElementById('signSelector').value;
      width = parseInt(document.getElementById('widthInput').value);
      height = parseInt(document.getElementById('heightInput').value);
      ChangeCanvas(); // Trigger draw() function again
    }

    function ChangeCanvas() {
      for (let i=textValx.length; i>=0; i--){
          if (counter>1) {
                textValx.shift();
                importantx.shift();
          };
        };
        for (let i=textValy.length; i>=0; i--){
          if (counter>1) {
                textValy.shift();
                importanty.shift();
          };
        };
      resizeCanvas(width, height);
      loadPixels();

      for (let x = 0; x <= width; x++) {
        for (let y = 0; y <= height; y++) {
          let a = map(x, 0, width, -width/height, width/height)/parseFloat(document.getElementById('ZoomInput').value)+parseFloat(document.getElementById('XInput').value);
          let b = map(y, 0, height, -1, 1)/parseFloat(document.getElementById('ZoomInput').value)-parseFloat(document.getElementById('YInput').value);
          let ca = a;
          let cb = b;
          let n = 0;
          while (Math.abs(a)+Math.abs(b) <= parseFloat(document.getElementById('MaxVal').value) && n < parseFloat(document.getElementById('MaxIt').value)) {
            n++;
            let aa, bb;
            if (selectedFunction=="sinZ"){
              aa = Math.sin(a) * (Math.exp(b) + Math.exp(-b)) / 2;
              bb = Math.cos(a)*(-Math.exp(-b)+Math.exp(b))/2;
            } else if (selectedFunction=="cosZ"){
                aa = Math.cos(a) * (Math.exp(b) + Math.exp(-b)) / 2;
                bb = Math.sin(a)*(Math.exp(-b)-Math.exp(b))/2;
            } else if (selectedFunction=="zSquared"){
                aa = a * a - b * b;
                bb = 2 * a * b;
            } else if (selectedFunction=="zPowerZ"){
                aa = Math.exp(a/2*Math.log(a*a+b*b)-b*Math.atan(b/a))*Math.sin(a*Math.atan(b/a)+b/2*Math.log(a*a+b*b));
                bb = Math.exp(a/2*Math.log(a*a+b*b)-b*Math.atan(b/a))*Math.cos(a*Math.atan(b/a)+b/2*Math.log(a*a+b*b));
            };
            if (selectedSign=="plus"){
              a = aa + ca;
              b = bb + cb;
            } else if (selectedSign=="minus"){
              a = aa - ca;
              b = bb - cb;
            } else if (selectedSign=="multiply"){
              a = aa * ca;
              b = bb * cb;
            } else if (selectedSign=="divide"){
              a = aa / ca;
              b = bb / cb;
            };
          }
          let pixelIndex = (x + y * width) * 4;
          if(n<parseFloat(document.getElementById('MaxIt').value)){
            pixels[pixelIndex] = red(map(n, 0, parseFloat(document.getElementById('MaxIt').value)-1, parseFloat(document.getElementById("Red1").value), parseFloat(document.getElementById("Red2").value)));
            pixels[pixelIndex + 1] = green(map(n, 0, parseFloat(document.getElementById('MaxIt').value)-1, parseFloat(document.getElementById ("Green1").value), parseFloat(document.getElementById("Green2").value)));
            pixels[pixelIndex + 2] = blue(map(n, 0, parseFloat(document.getElementById('MaxIt').value)-1, parseFloat(document.getElementById( "Blue1").value), parseFloat(document.getElementById("Blue2").value)));
            pixels[pixelIndex + 3] = 255;
          }
          else{
            pixels[pixelIndex] = red(parseFloat(document.getElementById("Red3").value));
            pixels[pixelIndex + 1] = green(parseFloat(document.getElementById("Green3").value));
            pixels[pixelIndex + 2] = blue(parseFloat(document.getElementById("Blue3").value));
            pixels[pixelIndex + 3] = 255;
          }
          if (x==width/2 || y==height/2) {
            pixels[pixelIndex] = red(0);
            pixels[pixelIndex + 1] = green(0);
            pixels[pixelIndex + 2] = blue(0);
            pixels[pixelIndex + 3] = 255;
          }
          width = parseInt(document.getElementById('widthInput').value);
          height = parseInt(document.getElementById('heightInput').value);
          let zoom = parseFloat(document.getElementById('ZoomInput').value);
          if (y == height / 2 && x > 0 && x < width - 20 && x%100==0) {
            let mapped = map(x + 100, 0, width, -width / height, width / height) / zoom - map(x, 0, width, -width / height, width / height) / zoom;           
            for (let k = -5; k <= 5; k++) {
              if (mapped <= 10 ** k) {
                // textAlign(LEFT);
                if (k>=1){k=0}
                textValx.push((Math.round(10 ** (-k + 1) * (map(x, 0, width, -width / height, width / height) / zoom+parseFloat(document.getElementById('XInput').value))) / 10 ** (-k + 1)).toString());
                // console.log('Without k x '+map(x, 0, width, -width / height, width / height) / zoom+parseFloat(document.getElementById('XInput').value));
                // console.log('With k x '+Math.round(10 ** (-k + 1) * (map(x, 0, width, -width / height, width / height) / zoom+parseFloat(document.getElementById('XInput').value))) / 10 ** (-k + 1));
                importantx.push(x);
                break;
              }
            }
            }
            if (x==width/2) {
            // console.log(x+" "+width/2)
          }
            if (x == width / 2 && y > 0 && y < height - 20 && y%100==0) {
            let mapped = map(y + 100, 0, height, -1, 1) / zoom - map(y, 0, height, -1, 1) / zoom; 
            // console.log(mapped)          
            for (let k = -5; k <= 5; k++) {
              if (mapped <= 10 ** k) {
                // textAlign(LEFT);
                textValy.push((Math.round(10 ** (-k + 1) * (-map(y, 0, height, -1, 1) / zoom+parseFloat(document.getElementById('YInput').value))) / 10 ** (-k + 1)).toString());
                console.log(textValy)
                console.log('Without k y '+(map(y, 0, height, -1, 1)/zoom-parseFloat(document.getElementById('YInput').value)));
                console.log('With k y '+(Math.round(10 ** (-k + 1) * (map(y, 0, height, -1, 1) / zoom-parseFloat(document.getElementById('YInput').value))) / 10 ** (-k + 1)).toString());
                importanty.push(y);
                break;
              }
            }
          };
        };
      };
      updatePixels();
      width = parseInt(document.getElementById('widthInput').value);
      height = parseInt(document.getElementById('heightInput').value);
      for (let i = importantx.length; i >=0; i--) {
        strokeWeight(2);
        stroke(0);
        line(importantx[i], (height/2)-5,importantx[i], (height/2)+5);
      }
      for (let i = textValx.length; i >= 0; i--) {
      fill(255);
      text(textValx[i], importantx[i], height/2 + 20);
      }
      for (let i = importanty.length; i >=0; i--) {
        fill(0);
        stroke(0);
        line((width/2)-5, importanty[i],(width/2)+5,importanty[i]);
      }
      for (let i = textValy.length; i >= 0; i--) {
      fill(255);
      text(textValy[i], width/2 + 20,importanty[i]);
      }
    }
    document.body.addEventListener("keydown",(ev) => {
      if(ev.key=="ArrowLeft"){
        document.getElementById('XInput').value = parseFloat(document.getElementById('XInput').value)-width/4/height;
      visualise();
      }else if(ev.key=="ArrowRight"){
        document.getElementById('XInput').value = parseFloat(document.getElementById('XInput').value)+width/4/height;
      visualise();
      }if(ev.key=="ArrowUp"){
        document.getElementById('YInput').value = parseFloat(document.getElementById('YInput').value)+1/4;
      visualise();
      }if(ev.key=="ArrowDown"){
        document.getElementById('YInput').value = parseFloat(document.getElementById('YInput').value)-1/4;
      visualise();
      };
    });
      for (let i = 2; i >= 0; i--) {
  for (let j = 3; j >= 1; j--) {
    let colors = ["Blue", "Red", "Green"];
    let input = document.getElementById(colors[i] + j);
    input.addEventListener("input", () => {
      let redVal = parseInt(document.getElementById('Red' + j).value);
      let greenVal = parseInt(document.getElementById('Green' + j).value);
      let blueVal = parseInt(document.getElementById('Blue' + j).value);

      for (let d = 0; d <= 2; d++) {
        let targetElem = document.getElementById(colors[d] + j + j);
        targetElem.style.color = `rgb(${redVal}, ${greenVal}, ${blueVal})`;
        console.log(targetElem.style.color);
        console.log(targetElem);
      }
    });
  }
}


  </script>
</body>
</html>
